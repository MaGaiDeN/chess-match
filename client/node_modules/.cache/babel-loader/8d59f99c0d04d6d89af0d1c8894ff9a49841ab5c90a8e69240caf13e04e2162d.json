{"ast":null,"code":"import { Chess } from 'chess.js';\nconst validateFEN = fen => {\n  // Validación básica de FEN\n  const parts = fen.split(' ');\n  if (parts.length !== 6) return false;\n  const [board, turn, castling, enPassant, halfmove, fullmove] = parts;\n\n  // Validar estructura del tablero\n  const ranks = board.split('/');\n  if (ranks.length !== 8) return false;\n\n  // Validar cada fila\n  for (const rank of ranks) {\n    let squares = 0;\n    for (const char of rank) {\n      if ('12345678'.includes(char)) {\n        squares += parseInt(char);\n      } else if ('pnbrqkPNBRQK'.includes(char)) {\n        squares += 1;\n      } else {\n        return false;\n      }\n    }\n    if (squares !== 8) return false;\n  }\n\n  // Validar turno\n  if (!['w', 'b'].includes(turn)) return false;\n  return true;\n};\nconst parsePGN = pgnText => {\n  const puzzles = [];\n  console.log('Iniciando procesamiento de PGN...');\n  const games = pgnText.split('\\n\\n[Event');\n  console.log(`Encontrados ${games.length} puzzles para procesar`);\n  games.forEach((game, index) => {\n    try {\n      const puzzleText = index === 0 ? game : '[Event' + game;\n      const eventMatch = puzzleText.match(/\\[Event \"([^\"]+)\"\\]/);\n      const fenMatch = puzzleText.match(/\\[FEN \"([^\"]+)\"\\]/);\n      const solutionMatch = puzzleText.match(/\\[Solution \"([^\"]+)\"\\]/);\n      if (eventMatch && fenMatch && solutionMatch) {\n        const event = eventMatch[1];\n        const fen = fenMatch[1].trim();\n        const solutionText = solutionMatch[1];\n        const solution = solutionText.split(' ');\n        if (validateFEN(fen)) {\n          const puzzle = {\n            id: index + 1,\n            event: event,\n            fen: fen,\n            solution: solution,\n            isMate: solutionText.includes('#'),\n            turnToPlay: fen.includes(' w ') ? 'w' : 'b'\n          };\n          puzzles.push(puzzle);\n          console.log(`Puzzle ${index + 1} procesado correctamente:`, puzzle);\n        }\n      }\n    } catch (error) {\n      console.error(`Error al procesar puzzle ${index + 1}:`, error);\n    }\n  });\n  return puzzles;\n};\nexport const loadPuzzlesFromPGN = async () => {\n  try {\n    console.log('Cargando archivo de puzzles...');\n    const puzzlePath = process.env.PUBLIC_URL + '/data/puzzles/mate-en-dos-processed.pgn';\n    console.log('Intentando cargar puzzles desde:', puzzlePath);\n    const response = await fetch(puzzlePath);\n    if (!response.ok) {\n      throw new Error(`HTTP error! status: ${response.status}`);\n    }\n    const pgnText = await response.text();\n    console.log('Archivo PGN cargado, tamaño:', pgnText.length, 'bytes');\n    const cleanPgnText = pgnText.trim().replace(/^\\uFEFF/, '');\n    const puzzles = parsePGN(cleanPgnText);\n\n    // Validar FEN de cada puzzle\n    const validPuzzles = puzzles.filter(puzzle => {\n      try {\n        const chess = new Chess();\n        chess.load(puzzle.fen);\n        return true;\n      } catch (error) {\n        console.error('FEN inválido descartado:', puzzle.fen);\n        return false;\n      }\n    });\n    console.log('Puzzles válidos procesados:', validPuzzles.length);\n    return validPuzzles;\n  } catch (error) {\n    console.error('Error loading puzzles:', error);\n    return [];\n  }\n};\nexport const getRandomPuzzle = puzzles => {\n  if (!puzzles || puzzles.length === 0) {\n    console.error('No hay puzzles disponibles');\n    return null;\n  }\n  const randomIndex = Math.floor(Math.random() * puzzles.length);\n  const selectedPuzzle = puzzles[randomIndex];\n  console.log('Puzzle seleccionado:', selectedPuzzle);\n  return selectedPuzzle;\n};","map":{"version":3,"names":["Chess","validateFEN","fen","parts","split","length","board","turn","castling","enPassant","halfmove","fullmove","ranks","rank","squares","char","includes","parseInt","parsePGN","pgnText","puzzles","console","log","games","forEach","game","index","puzzleText","eventMatch","match","fenMatch","solutionMatch","event","trim","solutionText","solution","puzzle","id","isMate","turnToPlay","push","error","loadPuzzlesFromPGN","puzzlePath","process","env","PUBLIC_URL","response","fetch","ok","Error","status","text","cleanPgnText","replace","validPuzzles","filter","chess","load","getRandomPuzzle","randomIndex","Math","floor","random","selectedPuzzle"],"sources":["C:/Users/magai/Desktop/chess-match/client/src/services/puzzleService.js"],"sourcesContent":["import { Chess } from 'chess.js';\r\n\r\nconst validateFEN = (fen) => {\r\n  // Validación básica de FEN\r\n  const parts = fen.split(' ');\r\n  if (parts.length !== 6) return false;\r\n  \r\n  const [board, turn, castling, enPassant, halfmove, fullmove] = parts;\r\n  \r\n  // Validar estructura del tablero\r\n  const ranks = board.split('/');\r\n  if (ranks.length !== 8) return false;\r\n  \r\n  // Validar cada fila\r\n  for (const rank of ranks) {\r\n    let squares = 0;\r\n    for (const char of rank) {\r\n      if ('12345678'.includes(char)) {\r\n        squares += parseInt(char);\r\n      } else if ('pnbrqkPNBRQK'.includes(char)) {\r\n        squares += 1;\r\n      } else {\r\n        return false;\r\n      }\r\n    }\r\n    if (squares !== 8) return false;\r\n  }\r\n  \r\n  // Validar turno\r\n  if (!['w', 'b'].includes(turn)) return false;\r\n  \r\n  return true;\r\n};\r\n\r\nconst parsePGN = (pgnText) => {\r\n  const puzzles = [];\r\n  console.log('Iniciando procesamiento de PGN...');\r\n  \r\n  const games = pgnText.split('\\n\\n[Event');\r\n  console.log(`Encontrados ${games.length} puzzles para procesar`);\r\n  \r\n  games.forEach((game, index) => {\r\n    try {\r\n      const puzzleText = index === 0 ? game : '[Event' + game;\r\n      \r\n      const eventMatch = puzzleText.match(/\\[Event \"([^\"]+)\"\\]/);\r\n      const fenMatch = puzzleText.match(/\\[FEN \"([^\"]+)\"\\]/);\r\n      const solutionMatch = puzzleText.match(/\\[Solution \"([^\"]+)\"\\]/);\r\n      \r\n      if (eventMatch && fenMatch && solutionMatch) {\r\n        const event = eventMatch[1];\r\n        const fen = fenMatch[1].trim();\r\n        const solutionText = solutionMatch[1];\r\n        \r\n        const solution = solutionText.split(' ');\r\n        \r\n        if (validateFEN(fen)) {\r\n          const puzzle = {\r\n            id: index + 1,\r\n            event: event,\r\n            fen: fen,\r\n            solution: solution,\r\n            isMate: solutionText.includes('#'),\r\n            turnToPlay: fen.includes(' w ') ? 'w' : 'b'\r\n          };\r\n          puzzles.push(puzzle);\r\n          console.log(`Puzzle ${index + 1} procesado correctamente:`, puzzle);\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error(`Error al procesar puzzle ${index + 1}:`, error);\r\n    }\r\n  });\r\n  \r\n  return puzzles;\r\n};\r\n\r\nexport const loadPuzzlesFromPGN = async () => {\r\n  try {\r\n    console.log('Cargando archivo de puzzles...');\r\n    const puzzlePath = process.env.PUBLIC_URL + '/data/puzzles/mate-en-dos-processed.pgn';\r\n    console.log('Intentando cargar puzzles desde:', puzzlePath);\r\n    \r\n    const response = await fetch(puzzlePath);\r\n    \r\n    if (!response.ok) {\r\n      throw new Error(`HTTP error! status: ${response.status}`);\r\n    }\r\n    \r\n    const pgnText = await response.text();\r\n    console.log('Archivo PGN cargado, tamaño:', pgnText.length, 'bytes');\r\n    \r\n    const cleanPgnText = pgnText.trim().replace(/^\\uFEFF/, '');\r\n    const puzzles = parsePGN(cleanPgnText);\r\n    \r\n    // Validar FEN de cada puzzle\r\n    const validPuzzles = puzzles.filter(puzzle => {\r\n      try {\r\n        const chess = new Chess();\r\n        chess.load(puzzle.fen);\r\n        return true;\r\n      } catch (error) {\r\n        console.error('FEN inválido descartado:', puzzle.fen);\r\n        return false;\r\n      }\r\n    });\r\n\r\n    console.log('Puzzles válidos procesados:', validPuzzles.length);\r\n    return validPuzzles;\r\n  } catch (error) {\r\n    console.error('Error loading puzzles:', error);\r\n    return [];\r\n  }\r\n};\r\n\r\nexport const getRandomPuzzle = (puzzles) => {\r\n  if (!puzzles || puzzles.length === 0) {\r\n    console.error('No hay puzzles disponibles');\r\n    return null;\r\n  }\r\n  const randomIndex = Math.floor(Math.random() * puzzles.length);\r\n  const selectedPuzzle = puzzles[randomIndex];\r\n  console.log('Puzzle seleccionado:', selectedPuzzle);\r\n  return selectedPuzzle;\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}